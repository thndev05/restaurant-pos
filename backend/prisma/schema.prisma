// ===== CONFIG =====
generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ===== ENUMS =====
enum TableStatus {
  AVAILABLE
  OCCUPIED
  RESERVED
  OUT_OF_SERVICE
}

enum RoleName {
  ADMIN
  MANAGER
  CASHIER
  WAITER
  KITCHEN
}

// ===== MODELS =====
model MenuItem {
  id          String    @id @default(uuid())
  name        String
  description String?
  price       Decimal   @db.Decimal(10,2)
  image       String?
  isAvailable Boolean   @default(true)
  isActive    Boolean   @default(true)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  // foreign key
  categoryId  String?
  category    Category? @relation("CategoryToMenuItems", fields: [categoryId], references: [id])

  @@map("menu_items")
}

model Category {
  id          String     @id @default(uuid())
  name        String     @unique
  isActive    Boolean    @default(true)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt

  // Relations
  menuItems   MenuItem[] @relation("CategoryToMenuItems")

  @@map("categories")
}

model Table {
  id          String      @id @default(uuid())
  number      Int         @unique 
  capacity    Int         @default(2)
  status      TableStatus @default(AVAILABLE)
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt

  @@map("tables")
}

model Customer {
  id          String    @id @default(uuid())
  name        String
  phone       String    @unique
  isActive    Boolean   @default(true)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  @@map("customers")
}

model Permission {
  id             String                @id @default(uuid())
  name           String                @unique
  description    String?
  resource       String                // e.g., "menu-items", "orders", "users"
  action         String                // e.g., "create", "read", "update", "delete"
  
  // Relations
  roles          RolePermission[]
  
  createdAt      DateTime              @default(now())
  updatedAt      DateTime              @updatedAt

  @@unique([resource, action])
  @@map("permissions")
}

model Role {
  id             String                @id @default(uuid())
  name           RoleName              @unique
  displayName    String
  description    String?
  
  // Relations
  users          User[]                @relation("UserToRole")
  permissions    RolePermission[]

  createdAt      DateTime              @default(now())
  updatedAt      DateTime              @updatedAt

  @@map("roles")
}

model RolePermission {
  id             String       @id @default(uuid())
  
  // Foreign keys
  roleId         String
  role           Role         @relation(fields: [roleId], references: [id], onDelete: Cascade)
  
  permissionId   String
  permission     Permission   @relation(fields: [permissionId], references: [id], onDelete: Cascade)
  
  createdAt      DateTime     @default(now())
  
  @@unique([roleId, permissionId])
  @@map("role_permissions")
}

model User {
  id             String     @id @default(uuid())
  name           String
  username       String     @unique
  password       String
  isActive       Boolean    @default(true)

  // foreign key
  roleId         String
  role           Role       @relation("UserToRole", fields: [roleId], references: [id])

  createdAt      DateTime   @default(now())
  updatedAt      DateTime   @updatedAt

  @@map("users")
}